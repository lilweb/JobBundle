// Generated by CoffeeScript 1.6.3
(function() {
  var Application, Job, JobView, JobsCollection, JobsView, Parameter, Task, TaskCollection, TaskView, TasksView, _ref, _ref1, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  $(function() {
    var application;
    application = new Application();
    application.setParameters("magasin", "");
    return console.log("Starting application");
  });

  Application = (function(_super) {
    __extends(Application, _super);

    function Application() {
      _ref = Application.__super__.constructor.apply(this, arguments);
      return _ref;
    }

    Application.prototype.el = $("#container");

    Application.prototype.parameters = null;

    Application.prototype.initialize = function() {
      return this.jobsView = new JobsView();
    };

    Application.prototype.setParameters = function(parameters) {
      return this.parameters = parameters;
    };

    return Application;

  })(Backbone.View);

  Job = (function(_super) {
    __extends(Job, _super);

    function Job() {
      _ref1 = Job.__super__.constructor.apply(this, arguments);
      return _ref1;
    }

    Job.prototype.defaults = {
      id: null,
      name: null,
      dateCreation: null,
      dateUpdate: null,
      status: null
    };

    return Job;

  })(Backbone.Model);

  Task = (function(_super) {
    __extends(Task, _super);

    function Task() {
      _ref2 = Task.__super__.constructor.apply(this, arguments);
      return _ref2;
    }

    Task.prototype.defaults = {
      id: null,
      name: null,
      dateCreation: null,
      dateUpdate: null,
      status: null
    };

    return Task;

  })(Backbone.Model);

  Parameter = (function(_super) {
    __extends(Parameter, _super);

    function Parameter() {
      _ref3 = Parameter.__super__.constructor.apply(this, arguments);
      return _ref3;
    }

    Parameter.prototype.defaults = {
      nom: null
    };

    return Parameter;

  })(Backbone.Model);

  JobsCollection = (function(_super) {
    __extends(JobsCollection, _super);

    function JobsCollection() {
      _ref4 = JobsCollection.__super__.constructor.apply(this, arguments);
      return _ref4;
    }

    JobsCollection.prototype.model = Job;

    JobsCollection.prototype.url = "http://ping.me/app_dev.php/api/v1/jobs.json";

    return JobsCollection;

  })(Backbone.Collection);

  TaskCollection = (function(_super) {
    __extends(TaskCollection, _super);

    function TaskCollection() {
      _ref5 = TaskCollection.__super__.constructor.apply(this, arguments);
      return _ref5;
    }

    TaskCollection.prototype.model = Task;

    TaskCollection.prototype.id = null;

    TaskCollection.prototype.initialize = function(id) {
      return this.id = id;
    };

    TaskCollection.prototype.url = function() {
      if (this.id) {
        return "http://ping.me/app_dev.php/api/v1/tasks/" + this.id + ".json";
      }
    };

    return TaskCollection;

  })(Backbone.Collection);

  TaskView = (function(_super) {
    __extends(TaskView, _super);

    function TaskView() {
      _ref6 = TaskView.__super__.constructor.apply(this, arguments);
      return _ref6;
    }

    TaskView.prototype.tagName = "li";

    TaskView.prototype.initialize = function() {
      return this.model.bind("change", this.render);
    };

    TaskView.prototype.render = function() {
      var tmpl;
      tmpl = _.template($("#taskTemplate").html());
      console.log(this.model);
      this.$el.html(tmpl(this.model.toJSON()));
      return this;
    };

    return TaskView;

  })(Backbone.View);

  TasksView = (function(_super) {
    __extends(TasksView, _super);

    function TasksView() {
      _ref7 = TasksView.__super__.constructor.apply(this, arguments);
      return _ref7;
    }

    TasksView.prototype.id = null;

    TasksView.prototype.setId = function(id) {
      this.id = id;
      this.collection = new TaskCollection(id);
      this.collection.bind("add", this.renderTask, this);
      return this.collection.fetch().render;
    };

    TasksView.prototype.render = function() {
      var tmpl;
      tmpl = _.template($("#tasksTemplate").html());
      return tmpl({
        "id": this.id
      });
    };

    TasksView.prototype.renderTask = function(task) {
      var taskView;
      this.collection.add(task);
      taskView = new TaskView({
        model: task
      });
      return $("#tasks-" + this.id).append(taskView.render().el);
    };

    return TasksView;

  })(Backbone.View);

  JobView = (function(_super) {
    __extends(JobView, _super);

    function JobView() {
      _ref8 = JobView.__super__.constructor.apply(this, arguments);
      return _ref8;
    }

    JobView.prototype.tagName = "li";

    JobView.prototype.tasksView = null;

    JobView.prototype.events = {
      'click .infos': 'afficherTasks'
    };

    JobView.prototype.initialize = function() {
      return this.model.bind("change", this.render);
    };

    JobView.prototype.render = function() {
      var tmpl;
      tmpl = _.template($("#jobTemplate").html());
      this.$el.html(tmpl(this.model.toJSON()));
      return this;
    };

    JobView.prototype.afficherTasks = function(event) {
      var id;
      if (this.tasksView == null) {
        id = $(event.currentTarget).closest("div.infos").data("id");
        this.tasksView = new TasksView;
        this.tasksView.setId(id);
        this.$el.after(this.tasksView.render());
        return this.$el.toggleClass("open");
      } else {
        this.$el.next("ul.tasks").remove();
        this.tasksView = null;
        return this.$el.toggleClass("open");
      }
    };

    return JobView;

  })(Backbone.View);

  JobsView = (function(_super) {
    __extends(JobsView, _super);

    function JobsView() {
      _ref9 = JobsView.__super__.constructor.apply(this, arguments);
      return _ref9;
    }

    JobsView.prototype.$el = $("#jobs");

    JobsView.prototype.initialize = function() {
      this.collection = new JobsCollection();
      this.collection.bind("add", this.renderJob, this);
      return this.collection.fetch();
    };

    JobsView.prototype.renderJob = function(job) {
      var jobView;
      this.collection.add(job);
      jobView = new JobView({
        model: job
      });
      return $("ul.jobs").append(jobView.render().el);
    };

    return JobsView;

  })(Backbone.View);

}).call(this);
